#!/usr/bin/env bash

set -euo pipefail

readonly REPO=kubernetes-sigs/kind
readonly INSTALL="$HOME/.local/bin/kind"
readonly BASE_URL=https://api.github.com/repos/kubernetes-sigs/kind

VERSION=${1:-latest}

if [[ $VERSION == latest ]]; then
    VERSION=$(gh-helper get-latest-release-name "$REPO")
fi

echo "installing kind $VERSION"

DOWNLOAD_URL=$(
    gh-helper get-tag "$REPO" "$VERSION" \
    | jq -r \
        '.assets[]
        | select(.name == "kind-linux-amd64")
        | .browser_download_url
        '
)

FNAME=${DOWNLOAD_URL##*/}.${VERSION}

F=$(cache-get \
    "$DOWNLOAD_URL" \
    "$FNAME"
)

cp -v "$F" "$INSTALL"
chmod +x "$INSTALL"
