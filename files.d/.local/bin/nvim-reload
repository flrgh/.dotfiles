#!/usr/bin/env python3

import neovim
from glob import glob


def nvim_reload(sock):
    try:
        nvim = neovim.attach('socket', path=sock)
    except FileNotFoundError as e:
        return

    try:
        out = nvim.command_output('echo resolve("/proc/self")')
        pid = out.strip('\n').split('/')[-1]
        print(f'Reloading nvim pid={pid} sock={sock}')

        nvim.command('source $MYVIMRC')
    except neovim.NvimError as e:
        print(f'Reload failed sock={sock}: {e}')


def main():
    for sock in glob('/tmp/nvim*/0'):
        nvim_reload(sock)


if __name__ == '__main__':
    main()
