#!/bin/sh

set -euo pipefail

if ! docker image inspect lsp/lua:latest &>/dev/null; then
    "$HOME/.local/libexec/install/lsp/install-lua-language-server" &>/dev/null
fi


readonly DATA=$HOME/.cache/nvim/lua-lsp
mkdir -p "$DATA"/{log,meta}

exec docker run \
    --rm \
    --interactive \
    --network none \
    --volume "$HOME:$HOME" \
    --workdir "$PWD" \
    --user "$UID:$(id -g)" \
    lsp/lua:latest \
        --logpath="$DATA/log" \
        --metapath="$DATA/meta" \
        --locale=en-us \
        "$@"
