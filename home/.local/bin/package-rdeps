#!/usr/bin/env bash

set -eu

readonly pkg=${1?package name required}

# shellcheck source=home/.local/lib/bash/std.bash
. "$HOME"/.local/lib/bash/std.bash

if command-exists dnf5; then
    dnf5 \
        --quiet \
        repoquery \
        --installed \
        --whatdepends \
        "$pkg" \
    | sed -re 's/^([^:]+)-[0-9]+:[0-9]+.*/\1/' \
    | grep -xF -f <(ls-packages --name-only) \
    | sort -u

# rpm is faster than dnf but does not seem to be able to resolve everything
# to package names
elif command-exists rpm; then
    rpm \
        --query \
        --depends \
        "$pkg"
else
    echo "no rpm or dnf present--what do I do?"
    exit 1
fi
